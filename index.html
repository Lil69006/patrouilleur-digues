<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surveillance Digue</title>
    
    <!-- PWA Meta tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#764ba2">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Patrouilleur">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .header {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 24px;
            font-weight: 700;
        }
        
        .container {
            padding: 20px;
            max-width: 100%;
        }
        
        .section {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            margin-bottom: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .section h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .btn {
            display: block;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 10px;
            font-weight: 500;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border: none;
            cursor: pointer;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #00b894, #00cec9);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #fdcb6e, #e17055);
        }
        
        .emergency-button {
            background: linear-gradient(45deg, #e74c3c, #c0392b) !important;
            color: white;
            border: 3px solid #fff;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
            font-weight: bold;
            font-size: 16px;
            text-transform: uppercase;
            animation: pulse-red 2s infinite;
        }
        
        @keyframes pulse-red {
            0% { box-shadow: 0 0 20px rgba(231, 76, 60, 0.5); }
            50% { box-shadow: 0 0 30px rgba(231, 76, 60, 0.8); }
            100% { box-shadow: 0 0 20px rgba(231, 76, 60, 0.5); }
        }

        .status-bar {
            background: rgba(0,0,0,0.05);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            color: #555;
        }

        .water-level {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .current-level {
            font-size: 48px;
            font-weight: bold;
            color: #1976d2;
            margin: 20px 0;
            text-align: center;
        }

        .alert-high {
            color: #c62828 !important;
            animation: blink 1s infinite;
        }

        .alert-seuil1 { color: #7B1FA2 !important; }
        .alert-seuil1bis { color: #4CAF50 !important; }
        .alert-seuil2 { color: #FFC107 !important; }
        .alert-seuil3 { color: #FF9800 !important; }
        .alert-seuil4 { color: #D32F2F !important; animation: blink 1s infinite; }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }

        .alert-box {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: bold;
            text-align: center;
            border: 2px solid;
        }

        .alert-box.seuil1 {
            background: #F3E5F5;
            color: #7B1FA2;
            border-color: #7B1FA2;
        }

        .alert-box.seuil1bis {
            background: #E8F5E8;
            color: #4CAF50;
            border-color: #4CAF50;
        }

        .alert-box.seuil2 {
            background: #FFFDE7;
            color: #FFC107;
            border-color: #FFC107;
        }

        .alert-box.seuil3 {
            background: #FFF3E0;
            color: #FF9800;
            border-color: #FF9800;
        }

        .alert-box.seuil4 {
            background: #FFEBEE;
            color: #D32F2F;
            border-color: #D32F2F;
            animation: pulse-alert 2s infinite;
        }

        @keyframes pulse-alert {
            0% { background: #FFEBEE; }
            50% { background: #FFCDD2; }
            100% { background: #FFEBEE; }
        }

        .info-box {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }

        .info-box-warning {
            background: #ffebee;
            color: #d32f2f;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            border: 2px solid #d32f2f;
            font-weight: bold;
        }

        .chart-canvas {
            width: 100%;
            max-width: 800px;
            height: 300px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
            cursor: crosshair;
        }

        .chart-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .load-btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }

        .thresholds-legend {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .threshold-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 14px;
        }

        .threshold-color {
            width: 20px;
            height: 3px;
            margin-right: 10px;
            border-radius: 2px;
        }
        
        @media (max-width: 480px) {
            .container { padding: 10px; }
            .section { padding: 15px; }
            .current-level { font-size: 36px; }
            .chart-canvas { height: 250px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üö® Surveillance Digue</h1>
    </div>
    
    <div class="container">
        <div class="status-bar">
            üìÖ <script>document.write(new Date().toLocaleString('fr-FR'));</script> | üìç Lyon - R√©gion Auvergne-Rh√¥ne-Alpes
        </div>
        
        <!-- Bouton d'urgence -->
        <div class="section">
            <h2>üö® D√©claration d√©sordre</h2>
            
            <button class="btn emergency-button" style="width: 100%; padding: 20px;" onclick="declareIncident()">
                üö® D√©claration D√©sordre üö®
            </button>
            
            <a href="https://docs.google.com/document/d/1noVZoJXTRZhPxUgIgMmXy1exlvEX4D_l1iKgFVYniVs/edit?usp=sharing" class="btn btn-warning" target="_blank">
                üìù Modification de la d√©claration d'incidents
            </a>
        </div>
        
        <!-- Monitoring Station V300002001 -->
        <div class="section">
            <h2>üìä Station Pont Morand Lyon - Monitoring 24h</h2>
            
            <div class="water-level">
                <div style="text-align: center;">
                    <h3>üíß Hauteur d'eau actuelle</h3>
                    <div id="waterDisplay">
                        <div class="current-level" id="currentLevel">--</div>
                        <div id="lastUpdate" style="color: #666; font-size: 14px;">Chargement...</div>
                    </div>
                </div>
                
                <div id="alertZone" style="display: none;"></div>
                <div id="infoZone" style="display: none;"></div>
                
                <!-- L√©gende des seuils -->
                <div class="thresholds-legend">
                    <h4 style="margin-bottom: 10px;">üìè Seuils de surveillance</h4>
                    <div class="threshold-item">
                        <div class="threshold-color" style="background: #7B1FA2;"></div>
                        <span>Seuil de vigilance 1: 160 cm (1.60m)</span>
                    </div>
                    <div class="threshold-item">
                        <div class="threshold-color" style="background: #4CAF50;"></div>
                        <span>Seuil de vigilance 1bis: 280 cm (2.80m)</span>
                    </div>
                    <div class="threshold-item">
                        <div class="threshold-color" style="background: #FFC107;"></div>
                        <span>Seuil de vigilance 2: 360 cm (3.60m)</span>
                    </div>
                    <div class="threshold-item">
                        <div class="threshold-color" style="background: #FF9800;"></div>
                        <span>Seuil de vigilance 3 (niveau de protection): 460 cm (4.60m)</span>
                    </div>
                    <div class="threshold-item">
                        <div class="threshold-color" style="background: #D32F2F;"></div>
                        <span>Seuil de vigilance 4 (niveau de danger): 480 cm (4.80m)</span>
                    </div>
                </div>
                
                <!-- Graphique Canvas -->
                <div style="text-align: center;">
                    <canvas id="waterChart" class="chart-canvas" width="800" height="300"></canvas>
                    <div id="chartInfo" class="chart-info" style="display: none;">
                        <div id="clickInfo">Cliquez sur le graphique pour voir les d√©tails d'un point</div>
                        <div id="chartStats" style="margin-top: 10px; font-size: 14px; color: #666;"></div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="load-btn" onclick="loadWaterData()">
                        üîÑ Actualiser les donn√©es
                    </button>
                </div>
            </div>
            
            <!-- Liens externes -->
            <a href="https://www.vigicrues.gouv.fr/station/V300002001" class="btn btn-warning" target="_blank">
                üåä Station V300002001 - Vigicrues
            </a>
            
            <a href="https://superviseur.paratronic.com/" target="_blank" class="btn btn-warning">
                üîß Superviseur Paratronic (gemapilyon/lyon)
            </a>
        </div>
        
        <!-- Itin√©raires -->
        <div class="section">
            <h2>üó∫Ô∏è Itin√©raires Pr√©√©tablis</h2>
            <a href="https://www.google.com/maps/d/edit?mid=1Ss3l_BWgc8yQB2TRXtMxFobuIlsA9PU&usp=sharing" class="btn" target="_blank">
                üìç Itin√©raire 1: Triangle ‚Üí Eaux bleues
            </a>
            <a href="https://www.google.com/maps/d/edit?mid=1FXGfXu9ZXQ6v0BT7j1ganR-BI1smD2E&usp=sharing" class="btn" target="_blank">
                üìç Itin√©raire 2: Eaux bleues ‚Üí Digue Duclos
            </a>
            <a href="https://www.google.com/maps/d/edit?mid=1-jG504darrlvK7GmD9JHe41UyJSwP7s&usp=sharing" class="btn" target="_blank">
                üìç Itin√©raire 3: Digue Duclos ‚Üí Digue St Jean
            </a>
            <a href="https://www.google.com/maps/d/edit?mid=1TScm_4bW-ogoKfY1x2ySLCAf7y07ysM&usp=drive_link" class="btn" target="_blank">
                üìç Itin√©raire 4: Annexe 4 - Circuit C
            </a>
            <a href="https://www.google.com/maps/d/edit?mid=1KTcVxRP5L-GsPFniZyd6sjX-82wl51o&usp=drive_link" class="btn" target="_blank">
                üìç Itin√©raire 5: Annexe 5 - Circuit D
            </a>
        </div>
        
        <!-- Formulaires -->
        <div class="section">
            <h2>üìã Formulaires de Visite</h2>
            <div style="background: #ffebee; color: #d32f2f; padding: 15px; border-radius: 10px; margin: 15px 0; text-align: center; border: 2px solid #d32f2f; font-weight: bold;">
                üìù Remplir les formulaires de visite en fin de tourn√©e
            </div>
            <a href="https://docs.google.com/spreadsheets/d/1wV50ZsyoDJhcf5Lja5rl1S9TxsOauadMHmyo9slFQGs/edit?gid=0#gid=0" class="btn btn-secondary" target="_blank">
                üíß Formulaire "Visite des Eaux Bleues"
            </a>
            <a href="https://docs.google.com/spreadsheets/d/1Tsigd9S-qpZfZDQUeLgkA7RIWOTEeDww-NVUIempBMU/edit?gid=0#gid=0" class="btn btn-secondary" target="_blank">
                üèóÔ∏è Formulaire "Visite Digue Duclos"
            </a>
            <a href="https://docs.google.com/spreadsheets/d/1kBdOQFZrZ260ah69D6JFvHmQXbumgkTNcgMYXsYQoZs/edit?gid=0#gid=0" class="btn btn-secondary" target="_blank">
                ‚õ™ Formulaire "Visite Digue St Jean"
            </a>
        </div>
        
        <!-- Documents -->
        <div class="section">
            <h2>üìö Documents & Planning</h2>
            <a href="https://drive.google.com/drive/folders/1deKB9iZ3gYfjndRiJY3Dyod8UQw3kzTA" class="btn btn-success" target="_blank">
                üìÑ Documents d'Astreinte
            </a>
            <a href="https://docs.google.com/spreadsheets/d/1DHt0dOl-bFUE5TxNsH33UVqwarC1mSEv/edit?usp=drive_link&ouid=117931034611088760506&rtpof=true&sd=true" class="btn btn-success" target="_blank">
                üìÖ Planning d'Astreinte
            </a>
        </div>
    </div>

    <!-- Script principal -->
    <script>
        // Configuration avec votre URL Google Apps Script
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyPk6xoDabzo2oBoyPNyFAbPVuJgBGkYVhMNyK3zJAnOG_obFqo--f5CIX8VTyDTQE/exec';
        
        var chartData = [];
        
        // D√©finition des 5 seuils avec leurs nouvelles couleurs distinctes
        var thresholds = [
            { level: 1.60, color: '#7B1FA2', name: 'Seuil 1', description: 'Surveillance renforc√©e' },
            { level: 2.80, color: '#4CAF50', name: 'Seuil 1bis', description: 'Pr√©-alerte' },
            { level: 3.60, color: '#FFC107', name: 'Seuil 2', description: 'Vigilance' },
            { level: 4.60, color: '#FF9800', name: 'Seuil 3', description: 'Alerte' },
            { level: 4.80, color: '#D32F2F', name: 'Seuil 4', description: 'Alerte critique' }
        ];
        
        var canvas, ctx;
        
        // Nouvelle fonction declareIncident avec cr√©ation Google Docs
        function declareIncident() {
            const now = new Date();
            const incidentId = 'INC_' + now.getFullYear() + 
                              (now.getMonth() + 1).toString().padStart(2, '0') +
                              now.getDate().toString().padStart(2, '0') + '_' +
                              now.getHours().toString().padStart(2, '0') +
                              now.getMinutes().toString().padStart(2, '0') +
                              now.getSeconds().toString().padStart(2, '0') + '_' +
                              Math.random().toString(36).substr(2, 5).toUpperCase();
            
            const incidentDate = now.toLocaleDateString('fr-FR');
            const incidentTime = now.toLocaleTimeString('fr-FR');
            
            console.log('üö® D√©claration incident:', incidentId);
            
            // Afficher un message de chargement
            showLoadingMessage();
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const gpsCoords = position.coords.latitude.toFixed(6) + ', ' + position.coords.longitude.toFixed(6);
                        createGoogleDocsReport(incidentId, incidentDate, incidentTime, gpsCoords);
                    },
                    function(error) {
                        console.log('Erreur GPS:', error);
                        createGoogleDocsReport(incidentId, incidentDate, incidentTime, 'GPS non disponible');
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } else {
                createGoogleDocsReport(incidentId, incidentDate, incidentTime, 'GPS non support√©');
            }
        }

        function createGoogleDocsReport(id, date, time, gps) {
            // R√©cup√©rer les donn√©es d'eau actuelles si disponibles
            const currentLevelElement = document.getElementById('currentLevel');
            const waterLevel = currentLevelElement ? currentLevelElement.innerText.replace(' cm', '') : null;
            
            // D√©terminer le niveau d'alerte actuel
            let alertLevel = 'Normal';
            if (waterLevel && waterLevel !== '--') {
                const level = parseFloat(waterLevel) / 100; // Convertir en m√®tres
                if (level >= 4.80) alertLevel = 'SEUIL 4 - DANGER CRITIQUE';
                else if (level >= 4.60) alertLevel = 'SEUIL 3 - ALERTE';
                else if (level >= 3.60) alertLevel = 'SEUIL 2 - VIGILANCE';
                else if (level >= 2.80) alertLevel = 'SEUIL 1bis - PR√â-ALERTE';
                else if (level >= 1.60) alertLevel = 'SEUIL 1 - SURVEILLANCE RENFORC√âE';
            }
            
            // Pr√©parer les donn√©es pour l'envoi
            const reportData = {
                incidentId: id,
                date: date,
                time: time,
                gps: gps,
                agent: localStorage.getItem('agentName') || 'Patrouilleur d\'astreinte',
                waterLevel: waterLevel !== '--' ? waterLevel : null,
                alertLevel: alertLevel !== 'Normal' ? alertLevel : null
            };
            
            // Envoyer les donn√©es √† Google Apps Script
            fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', // Important pour √©viter les probl√®mes CORS
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(reportData)
            })
            .then(() => {
                // Avec no-cors, on ne peut pas lire la r√©ponse, mais on assume que √ßa a fonctionn√©
                hideLoadingMessage();
                showSuccessMessage(reportData);
                
                // Sauvegarder localement aussi
                saveIncidentLocally(reportData);
            })
            .catch(error => {
                console.error('Erreur lors de la cr√©ation du document:', error);
                hideLoadingMessage();
                // En cas d'erreur, utiliser la m√©thode locale
                generateLocalReport(reportData);
            });
        }

        function generateLocalReport(data) {
            let rapport = 'üö® RAPPORT D\'INCIDENT - PATROUILLE DES DIGUES\n';
            rapport += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            rapport += 'üìã INFORMATIONS AUTOMATIQUES\n';
            rapport += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n';
            rapport += '‚Ä¢ ID Incident: ' + data.incidentId + '\n';
            rapport += '‚Ä¢ Date: ' + data.date + '\n';
            rapport += '‚Ä¢ Heure: ' + data.time + '\n';
            rapport += '‚Ä¢ GPS: ' + data.gps + '\n';
            if (data.gps !== 'GPS non disponible' && data.gps !== 'GPS non support√©') {
                rapport += '‚Ä¢ Lien Maps: https://maps.google.com/?q=' + data.gps + '\n';
            }
            rapport += '‚Ä¢ Zone: Lyon - R√©gion Auvergne-Rh√¥ne-Alpes\n';
            rapport += '‚Ä¢ Agent: ' + data.agent + '\n';
            if (data.waterLevel) {
                rapport += '‚Ä¢ Hauteur d\'eau: ' + data.waterLevel + ' cm\n';
            }
            if (data.alertLevel) {
                rapport += '‚Ä¢ ‚ö†Ô∏è ALERTE: ' + data.alertLevel + '\n';
            }
            rapport += '\n‚ö†Ô∏è DESCRIPTION DE L\'INCIDENT\n';
            rapport += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n';
            rapport += 'Type: [√Ä compl√©ter]\n';
            rapport += 'Localisation pr√©cise: [√Ä compl√©ter]\n';
            rapport += 'Description: [√Ä compl√©ter]\n';
            rapport += '\nüîß ACTIONS ENTREPRISES\n';
            rapport += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n';
            rapport += '[√Ä compl√©ter]\n';
            
            // Copier dans le presse-papier
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(rapport).then(() => {
                    console.log('‚úÖ Rapport copi√© dans le presse-papier');
                    hideLoadingMessage();
                    alert('üö® INCIDENT ENREGISTR√â LOCALEMENT!\n\n' +
                          'ID: ' + data.incidentId + '\n' +
                          'GPS: ' + data.gps + '\n\n' +
                          'üìã Rapport copi√© dans le presse-papier!\n' +
                          'Le document mod√®le va s\'ouvrir - collez avec Ctrl+V');
                }).catch(error => {
                    console.error('Erreur copie:', error);
                    hideLoadingMessage();
                    showManualInstructions(data, rapport);
                });
            } else {
                hideLoadingMessage();
                showManualInstructions(data, rapport);
            }
            
            // Sauvegarder localement
            saveIncidentLocally(data);
            
            // Ouvrir le document Google template apr√®s un d√©lai
            setTimeout(() => {
                window.open('https://docs.google.com/document/d/1noVZoJXTRZhPxUgIgMmXy1exlvEX4D_l1iKgFVYniVs/edit?usp=sharing', '_blank');
            }, 1500);
        }

        function saveIncidentLocally(data) {
            try {
                // R√©cup√©rer les incidents existants
                let incidents = JSON.parse(localStorage.getItem('incidents') || '[]');
                
                // Ajouter le nouvel incident
                incidents.push({
                    ...data,
                    timestamp: new Date().toISOString()
                });
                
                // Garder seulement les 50 derniers incidents
                if (incidents.length > 50) {
                    incidents = incidents.slice(-50);
                }
                
                // Sauvegarder
                localStorage.setItem('incidents', JSON.stringify(incidents));
                console.log('‚úÖ Incident sauvegard√© localement');
            } catch (error) {
                console.error('Erreur sauvegarde locale:', error);
            }
        }

        function showLoadingMessage() {
            // Cr√©er un overlay de chargement
            const overlay = document.createElement('div');
            overlay.id = 'loadingOverlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 9999;
            `;
            
            const message = document.createElement('div');
            message.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                text-align: center;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            `;
            message.innerHTML = `
                <h3 style="color: #e74c3c; margin-bottom: 15px;">üö® Cr√©ation du rapport en cours...</h3>
                <p>R√©cup√©ration GPS et cr√©ation du document Google Docs</p>
                <div style="margin-top: 20px;">
                    <div style="width: 200px; height: 4px; background: #eee; border-radius: 2px; overflow: hidden;">
                        <div style="width: 50%; height: 100%; background: linear-gradient(90deg, #e74c3c, #c0392b);
